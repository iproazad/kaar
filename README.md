# نظام kaar لإدارة المستخدمين والأقسام

## نظرة عامة
نظام kaar هو منصة لإدارة الأشخاص والأقسام مع نظام صلاحيات متكامل يعتمد على Firebase. يتيح النظام للمسؤولين إدارة المستخدمين والأقسام مع تتبع كامل للتغييرات.

## الميزات الرئيسية
- نظام مصادقة متكامل باستخدام Firebase Authentication
- إدارة المستخدمين والصلاحيات
- إدارة الأقسام والأشخاص
- تتبع التغييرات وحفظها في قاعدة البيانات
- واجهة مستخدم سهلة الاستخدام
- دعم الوضع المظلم

## متطلبات النظام
- متصفح ويب حديث
- حساب Firebase

## الإعداد

### 1. إعداد مشروع Firebase
1. قم بإنشاء مشروع جديد في [Firebase Console](https://console.firebase.google.com/)
2. قم بتفعيل خدمات Firebase التالية:
   - Authentication (تفعيل تسجيل الدخول بالبريد الإلكتروني وكلمة المرور)
   - Firestore Database
   - Storage
   - Hosting
   - Functions

### 2. تثبيت أدوات Firebase
```bash
npm install -g firebase-tools
firebase login
firebase init
```

### 3. نشر قواعد الأمان والوظائف
```bash
firebase deploy --only firestore:rules,storage:rules,functions
```

### 4. إنشاء المستخدم الأول (المسؤول)
1. قم بإنشاء مستخدم جديد من خلال Firebase Console
2. قم بإضافة المستخدم إلى مجموعة المسؤولين يدويًا في Firestore:
   - أنشئ مجموعة `admins`
   - أضف مستند جديد باستخدام معرف المستخدم (UID) كاسم للمستند
   - أضف الحقول التالية:
     ```
     email: "بريد المستخدم"
     name: "اسم المستخدم"
     role: "admin"  // أو "superadmin" للمسؤول الأعلى
     createdAt: Timestamp.now()
     ```

### 5. إنشاء مستخدم مسؤول أعلى (superadmin)
1. قم بإنشاء مستخدم جديد من خلال Firebase Console أو من خلال واجهة النظام
2. قم بإضافة المستخدم إلى مجموعة المسؤولين في Firestore مع تحديد الدور كـ "superadmin":
   - أضف مستند جديد في مجموعة `admins` باستخدام معرف المستخدم (UID) كاسم للمستند
   - أضف الحقول التالية:
     ```
     email: "بريد المستخدم"
     name: "اسم المستخدم"
     role: "superadmin"
     createdAt: Timestamp.now()
     ```
3. يمكن أيضًا للمستخدم superadmin إنشاء مستخدمين آخرين بدور superadmin من خلال واجهة النظام

## هيكل قاعدة البيانات

### مجموعات Firestore
- **admins**: المستخدمون المسؤولون
- **sections**: الأقسام
- **persons**: الأشخاص
- **logs**: سجلات التغييرات

## صلاحيات المستخدمين

### المستخدم العادي (غير مسجل الدخول)
- عرض الأقسام والأشخاص فقط

### المسؤول (admin)
- إدارة الأقسام (إضافة، تعديل، حذف)
- إدارة الأشخاص (إضافة، تعديل، حذف)
- عرض سجلات التغييرات

### المسؤول الأعلى (superadmin)
- جميع صلاحيات المسؤول العادي
- إدارة المستخدمين المسؤولين (إضافة، تعديل، حذف)
- صلاحيات كاملة على النظام

## قواعد الأمان
تم تكوين قواعد الأمان لضمان أن المستخدمين المسؤولين فقط يمكنهم إجراء تغييرات على البيانات، بينما يمكن للمستخدمين العاديين عرض البيانات فقط.

## تتبع التغييرات
يتم تسجيل جميع التغييرات التي تتم على قاعدة البيانات في مجموعة `logs` مع تفاصيل المستخدم الذي قام بالتغيير ونوع التغيير والبيانات قبل وبعد التغيير.